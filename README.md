# WexNZ API

Перед Вами представлена документация API для работы с биржей [WexNZ](https://wex.nz)

- [Русский](https://github.com/WEXnz/wexapidoc/tree/master/ru)

# WexNZ API

API состоит из:
- [apiv1](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1)
- [apiv3](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv3)
- [apipush](https://github.com/WEXnz/wexapidoc/tree/master/ru/apipush)

# Оглавление

Данный апи предоставляет возможность получения доступа к торговой информации в реальном времени.
С помощью него вы можете получить информацию о изменениях в стакане и о сделках в реальном времени.

Данный API предоставляется используя сервиc Pusher. Вы можете почитать документацию Pusher здесь.
Ключ приложения - ee987526a24ba107824c
Так же не забудьте указать кластер (cluster) - eu

**Методы**:
- [trades](https://github.com/WEXnz/wexapidoc/tree/master/ru/apipush/trades.md) - На данных каналах рассылается информация о изменениях в стаканах.
- [depth](https://github.com/WEXnz/wexapidoc/tree/master/ru/apipush/depth.md) - На данных каналах рассылается информация о сделках.

# Каналы trades

На данных каналах рассылается информация о сделках.

Каналы имеют формат вида "<pair_name>.trades", например btc_usd.trades
Событие всегда имеет название trades и присылается при новых сделках на паре.

Пример события:
```json
[
  [
    "buy",
    "2467.762",
    "0.02862282"
  ],
  [
    "sell",
    "2463.105",
    "0.00428728"
  ],
  ...
]
```

**buy**: сделка покупки.
**sell**: сделка продажи.

# Каналы depth

На данных каналах рассылается информация о изменениях в стаканах.

Каналы имеют формат вида "<pair_name>.depth", например btc_usd.depth
Событие всегда имеет название depth и присылается при изменении стакана.

**Пример события**:
```json
{
  "ask": [
    [
      "2508.179",
      0
    ],
    [
      "2466.842",
      "0.15"
    ],
	...
  ],
  "bid": [
	...
  ]
}
```

**ask**: изменения в стакане на продажу.
**bid**: изменения в стакане на покупку.

Все изменения стакана присылаются в виде массивов, где первым значением является цена, а вторым изменение по данной цене.
Если изменение имеет значение 0, то это означает, что по данной цене в стакане больше нет предложений (ордер был отменен либо исполнен полностью).
Изменение отличное от нуля отражает текущее предложение по цене в стакане.

Данный API предоставляет возможность торговать на бирже и получать информацию об аккаунте.

Для использования данного API необходимо создать API-ключ.
API-ключ можно создать в профиле, раздел API-ключи. После создания API-ключа вам выдается ключ и секрет.
Обратите внимание на то, что получить секрет ключа можно только в первый час после создания ключа.
Данные API-ключа используются для аутентификации.

Все запросы к TradeAPI идут по следующему URL: https://wex.nz/tapi
Имя метода отправляется посредством POST-параметра method.
Все параметры методов отправляется через POST-параметры.
Все ответы от сервера приходят в формате JSON.
Для каждого запроса необходима аутентификация. Как произвести аутентификацию можно прочитать в соответствующем разделе данной документации.

При успешном выполнении запроса приходит ответ типа:
```json
{
	"success":1,
	"return":{<ответ>}
}
```

Ответ при ошибке:
```json
{
	"success":0,
	"error":"<ошибка>"
}
```

Так же при ошибке может придти ответ не в JSON формате. Как правило это случается при превышении лимитов к API либо при непредвиденных ошибках.

[Аутентификация](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/Auth.md)

**Методы**:
- [ActiveOrders](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/ActiveOrders.md) - Метод возращает список ваших активных ордеров.
- [CancelOrder](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/CancelOrder.md) - Метод отменяет ордер.
- [CoinDepositAddress](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/CoinDepositAddress.md) - Метод предназначен для получения депозитного адреса криптовалюты.
- [CreateCoupon](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/CreateCoupon.md) - Метод предназначен для создания купонов.
- [getInfo](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/getInfo.md) - Метод возвращает информацию о текущем балансе пользователя, привилегиях API-ключа, количество открытых ордеров и время сервера.
- [OrderInfo](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/OrderInfo.md) - Метод возвращает информацию о конкретном ордере.
- [RedeemCoupon](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/RedeemCoupon.md) - Метод предназначен для погашения купонов.
- [Trade](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/Trade.md) - Основной метод используя который можно создавать ордера и торговать на бирже.
- [TradeHistory](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/TradeHistory.md) - Возвращает историю сделок.
- [TransHistory](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/TransHistory.md) - Возвращает историю транзакций.
- [WithdrawCoin](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv1/WithdrawCoin.md) - Метод предназначен для вывода криптовалюты.

# Метод ActiveOrders

Возращает список ваших активных ордеров.
Для использования данного метода необходима привилегия ключа info.

Если ордер пропадает из списка, то он был исполнен или отменен.
**Необязательные параметры**:

**параметр** | **описание** | **принимает значение** | **стандартное значение**
------------ | ------------ | ------------- | -------------
pair | пара | btc_usd (пример) | все пары

Список пар можно получить используя метод info в PublicAPI v3.

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"343152":{
			"pair":"btc_usd",
			"type":"sell",
			"amount":12.345,
			"rate":485,
			"timestamp_created":1342448420,
			"status":0
		},
		...
	}
}
```

Ключи массива: Идентификатор ордера.
**pair**: Пара на которой был создан ордер.
**type**: Тип ордера buy/sell.
**amount**: Сколько осталось купить/продать.
**rate**: Цена покупки/продажи.
**timestamp_created**: Время когда был создан ордер.
**status**: Устарел, всегда 0.

Аутентификация происходит посредством отправки следующих HTTP-заголовков:
**Key** — API-ключ. Пример API-ключа: 46G9R9D6-WJ77XOIP-XH9HH5VQ-A3XN3YOZ-8T1R8I8T
*API -ключ создается в профиле, раздел API-ключи.*
**Sign** — Подпись. POST-параметры (?nonce=1&param0=val0), подписанные секретным ключом с помощью HMAC-SHA512

Так же для успешной аутентификации необходимо посылать POST-параметр nonce с инкрементым каждый запрос числовым значением.

Пример использования значения nonce:
- 1 запрос: nonce=1
- 2 запрос: nonce=2
- 3 запрос: nonce=10
- 4 запрос: nonce=10 — выдаст ошибку, потому что nonce равен прошлому запросу
- 5 запрос: nonce=11
- 6 запрос: nonce=9 — выдаст ошибку, потому что nonce меньше, чем значение nonce на API-ключе

Минимальное значение nonce - 1, максимальное - 4294967294.
Для обнуления значения nonce необходимо создать новый ключ.

# Метод CancelOrder

Метод предназначен для отмены ордера.

Для использования данного метода необходима привилегия ключа trade.

**Параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
order_id | идентификатор ордера | числовые 

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"order_id":343154,
		"funds":{
			"usd":325,
			"btc":24.998,
			"ltc":0,
			...
		}
	}
}
```

**order_id**: Идентификатор отмененного ордера.
**funds**: Баланс после запроса.

# Метод CoinDepositAddress

Метод предназначен для получения депозитного адреса криптовалюты.

Для использования данного метода необходима привилегия ключа info.

В данный момент метод не генерирует новые адреса. Поэтому произойдет ошибка, если вы запросите адрес по валюте, депозитный адрес для которой вы ранее не генерировали.

**Обязательные параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
coinName | криптовалюта | BTC, LTC (пример)

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"address":"1BARCQAEjxqp1sKneiFtBVTZzhTHBTYcN5"
	}
}
```

**address**: адрес для депозитов.

# Метод CreateCoupon

Метод предназначен для создания купонов.

**Обратите внимание**: Для использования данного метода необходима привилегия ключа coupon, которую на данный момент можно включить только через саппорт.

Необходимо заранее создать API-ключ с белым списком IP, который вы будете использовать для данного метода и сообщить в тикете первые 8 символов ключа (напр. HKG82W66) на котором необходимо подключить привилегию coupon.

**Обратите внимание** - белый список IP является обязательным условием для получения привилегии coupon. В противном случае вам будет отказано в получении данной привилегии.

Так как никакого дополнительного подтверждения при использовании данного метода не нужно, после включения данной привилегии на вашем API-ключе вы несете полную ответственность за сохранность секрета к данному ключу.

**Параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
currency | валюта | USD, BTC (пример)
amount | сумма для вывода | числовые
receiver | имя пользователя, которому предназначен купон | логин пользователя

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"coupon":"WEXUSD69AA4BBX1UAZ32BPLKBR0QZTX5AENVNFWNZHNQDZ",
		"transID":37832629,
		"funds":{
			"usd":325,
			"btc":24.998,
			"ltc":0,
			...
		}
	}
}
```

**coupon**: Сгенерированный купон.
**transID**: Идентификатор транзакции.
**funds**: Баланс после запроса.

# Метод getInfo

Возвращает информацию о текущем балансе пользователя, привилегиях API-ключа, количество открытых ордеров и время сервера.

Для использования данного метода необходима привилегия ключа info.

**Параметры**:
Нету.

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"funds":{
			"usd":325,
			"btc":23.998,
			"ltc":0,
			...
		},
		"rights":{
			"info":1,
			"trade":0,
			"withdraw":0
		},
		"transaction_count":0,
		"open_orders":1,
		"server_time":1342123547
	}
}
```

**funds**: Баланс аккаунта доступный к использованию. Не включает деньги на ваших открытых ордерах.
**rights**: Привилегии текущего API-ключа. Привилегия withdraw в данный момент нигде не используется.
**transaction_count**: Устарело, всегда 0.
**open_orders**: Количество ваших открытых ордеров.
**server_time**: Время сервера (MSK).

# Метод OrderInfo

Возращает информацию о конкретном ордере.

Для использования данного метода необходима привилегия ключа info.

**Параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
order_id | идентификатор ордера | числовые 

параметр	описание	принимает значение
order_id	идентификатор ордера	числовые

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"343152":{
			"pair":"btc_usd",
			"type":"sell",
			"start_amount":13.345,
			"amount":12.345,
			"rate":485,
			"timestamp_created":1342448420,
			"status":0
		}
	}
}
```

Ключ массива: Идентификатор ордера.
**pair**: Пара на которой был создан ордер.
**type**: Тип ордера, buy/sell.
**start_amount**: Начальная сумма которая была при создании ордера.
**amount**: Сколько осталось купить/продать.
**rate**: Цена покупки/продажи.
**timestamp_created**: Время когда был создан ордер.
**status**: 0 - активен, 1 - исполненный ордер, 2 - отмененный, 3 - отмененный, но был частично исполнен.

# Метод RedeemCoupon

Метод предназначен для погашения купонов.

**Обратите внимание**: Для использования данного метода необходима привилегия ключа coupon, которую на данный момент можно включить только через саппорт.

Необходимо заранее создать API-ключ с белым списком IP, который вы будете использовать для данного метода и сообщить в тикете первые 8 символов ключа (напр. HKG82W66) на котором необходимо подключить привилегию coupon.

**Обратите внимание** - белый список IP является обязательным условием для получения привилегии coupon. В противном случае вам будет отказано в получении данной привилегии.

Так как никакого дополнительного подтверждения при использовании данного метода не нужно, после включения данной привилегии на вашем API-ключе вы несете полную ответственность за сохранность секрета к данному ключу.

**Параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
coupon | купон | WEXUSD... (пример)

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"couponAmount":"1",
		"couponCurrency":"USD",
		"transID":37832629,
		"funds":{
			"usd":325,
			"btc":24.998,
			"ltc":0,
			...
		}
	}
}
```

**couponAmount**: Сумма которая была погашена.
**couponCurrency**: Валюта купона который был погашен.
**transID**: Идентификатор транзакции.
**funds**: Баланс после запроса.

# Метод Trade

Основной метод используя который можно создавать ордера и торговать на бирже.
Для использования данного метода необходима привилегия ключа trade.

С помощью данного метода можно создавать только лимит ордера, но можно эмулировать маркет ордера с помощью параметра rate. Например используя rate=0.1 при продаже можно продать по самой выгодней цене по рынку.

У каждой пары разные ограничения на минимальную/максимальную суммы, минимальное количество и количество знаков после запятой. Все ограничения можно получить с помощью метода info в PublicAPI v3.

**Параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
pair | пара | btc_usd (пример)
type | тип операции | buy или sell
rate | курс по которому необходимо купить/продать | числовые
amount | количество которое необходимо купить/продать | числовые

Список пар можно получить используя метод info в PublicAPI v3.
**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"received":0.1,
		"remains":0,
		"order_id":0,
		"funds":{
			"usd":325,
			"btc":2.498,
			"ltc":0,
			...
		}
	}
}
```

**received**: Сколько валюты куплено/продано.
**remains**: Сколько валюты осталось купить/продать (и на сколько был создан ордер).
**order_id**: Имеет значение 0 если запрос был полностью удовлетворен встречными ордерами, в противном случае возращает идентификатор созданного ордера.
**funds**: Баланс после запроса.

# Метод TradeHistory

Возвращает историю сделок.

Для использования данного метода необходима привилегия ключа info.

**Необязательные параметры**:

**параметр** | **описание** | **принимает значение** | **стандартное значение**
------------ | ------------ | ------------- | -------------
from | номер сделки, с которой начинать вывод | числовые	0
count | количество сделок на вывод	числовые | 1000
from_id | id сделки, с которой начинать вывод | числовые	0
end_id | id сделки, на которой заканчивать вывод | числовые	∞
order | сортировка | ASC или DESC | DESC
since | с какого времени начинать вывод | UNIX time | 0
end | на каком времени заканчивать вывод | UNIX time | ∞
pair | пара, по которой выводить сделки | btc_usd (пример) | все пары

При использовании параметров since или end, параметр order автоматически принимает значение ASC.
При использовании параметра since максимальная дата по которой можно получить историю - неделю назад.

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"166830":{
			"pair":"btc_usd",
			"type":"sell",
			"amount":1,
			"rate":450,
			"order_id":343148,
			"is_your_order":1,
			"timestamp":1342445793
		}
	}
}
```

Ключи массива: Идентификатор сделки.
**pair**: Пара на которой была сделка.
**type**: Тип сделки, buy/sell.
**amount**: Количество купленного/проданного.
**rate**: Цена покупки/продажи.
**order_id**: Идентификатор ордера.
**is_your_order**: Значение 1 если order_id является вашим ордером, в противном случае 0.
**timestamp**: Время сделки.

# Метод TransHistory

Возвращает историю транзакций.

Для использования данного метода необходима привилегия ключа info.

**Необязательные параметры**:

**параметр** | **описание** | **принимает значение** | **стандартное значение**
------------ | ------------ | ------------- | -------------
from | номер транзакции, с которой начинать вывод | числовые | 0
count | количество транзакций на вывод | числовые | 1000
from_id | id транзакции, с которой начинать вывод | числовые | 0
end_id | id транзакции, на которой заканчивать вывод | числовые | ∞
order | сортировка | ASC или DESC | DESC
since | с какого времени начинать вывод | UNIX time | 0
end | на каком времени заканчивать вывод | UNIX time | ∞

При использовании параметров since или end, параметр order автоматически принимает значение ASC.

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"1081672":{
			"type":1,
			"amount":1.00000000,
			"currency":"BTC",
			"desc":"BTC Payment",
			"status":2,
			"timestamp":1342448420
		}
	}
}
```

Ключи массива: Идентификатор транзакции.
**type**: Тип транзакции. 1/2 - ввод/вывод, 4/5 - приход/расход.
**amount**: Сумма транзакции.
**currency**: Валюта транзакции.
**desc**: Описание транзакции.
**status**: Статус транзакции. 0 - отклонено/неуспешно, 1 - ожидание акцепта, 2 - успешно, 3 - не подтверждено
**timestamp**: Время транзакции.

# Метод WithdrawCoin

Метод предназначен для вывода криптовалюты.

**Обратите внимание**: Для использования данного метода необходима привилегия ключа withdraw, которую на данный момент можно включить только через саппорт.

Необходимо заранее создать API-ключ который вы будете использовать для данного метода и сообщить в тикете первые 8 символов ключа (напр. HKG82W66) на котором необходимо подключить привилегию withdraw.

Так как никакого дополнительного подтверждения вывода при использовании данного метода не нужно, после включения данной привилегии на вашем API-ключе вы несете полную ответственность за сохранность секрета к данному ключу.

**Параметры**:

**параметр** | **описание** | **принимает значение**
------------ | ------------ | -------------
coinName | валюта | BTC, LTC (пример)
amount | сумма для вывода | числовые
address | адрес для вывода | адрес

**Пример ответа**:
```json
{
	"success":1,
	"return":{
		"tId":37832629,
		"amountSent":0.009,
		"funds":{
			"usd":325,
			"btc":24.998,
			"ltc":0,
			...
		}
	}
}
```

**tId**: Идентификатор транзакции.
**amountSent**: Фактически отправленная сумма, учитывая комиссию.
**funds**: Баланс после запроса.

# Оглавление
Данный апи предоставляет возможность доступа к такой информации, как: тикеры пар, активные ордера пар, последние торги по паре и др.

Все запросы к API идут по следующему адресу:
https://wex.nz/api/3/<имя метода>/<перечисление пар>

Пары перечисляются используя знак тире (-) для разделения, например:
https://wex.nz/api/3/ticker/btc_usd-btc_rur

Можно использовать любое количество пар в перечислении. Дубликаты не допускаются. Так же можно использовать только одну пару, например:
https://wex.nz/api/3/ticker/btc_usd
Множество пар работает со всеми методами представленными в паблик апи, кроме info.

Вся информация кэшируется каждые 2 секунды, поэтому нет смысла делать запросы чаще.
Все ответы от апи приходят в формате JSON.

**Важно!** Апи начнет выдавать ошибку, если мы отключим одну из пар перечисленных в вашем запросе. Если вы не собираетесь синхронизировать состояние пар через метод info, стоит присылать GET-параметр ignore_invalid равным 1, например:
https://wex.nz/api/3/ticker/btc_usd-btc_btc?ignore_invalid=1
Без параметра ignore_invalid этот запрос вызвал бы ошибку из-за несуществующей пары.

**Методы**:
- [trade](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv3/trades.md) - Данный метод предоставляет информацию о последних сделках.
- [depth](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv3/depth.md) - Данный метод предоставляет информацию о активных ордерах пары.
- [ticker](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv3/ticker.md) - Данный метод предоставляет всю информацию о торгах по паре
- [info](https://github.com/WEXnz/wexapidoc/tree/master/ru/apiv3/info.md) - Данный метод предоставляет всю информацию о текущих активных парах

# Метод depth

Данный метод предоставляет информацию о активных ордерах пары.

Дополнительно принимает необязательный GET-параметр limit, который указывает, сколько ордеров нужно вывести (по умолчанию 150).
Принимает значение не более 5000.

**Пример запроса**:
https://wex.nz/api/3/depth/btc_usd

**Пример ответа**:
```json
{
	"btc_usd":{
		"asks":[
			[103.426,0.01],
			[103.5,15],
			[103.504,0.425],
			[103.505,0.1],
			...
		],
		"bids":[
			[103.2,2.48502251],
			[103.082,0.46540304],
			[102.91,0.99007913],
			[102.83,0.07832332],
			...
		]
	}
	...
}
```

**asks**: ордера на продажу.
**bids**: ордера на покупку.

# Метод info

Данный метод предоставляет всю информацию о текущих активных парах, такую как: максимальное количество знаков после запятой при торгах, минимальную цену, максимальную цену, минимальное количество при покупке/продаже, скрыта ли пара и комиссию по паре.

**Пример запроса**:
https://wex.nz/api/3/info

**Пример ответа**:
```json
{
	"server_time":1370814956,
	"pairs":{
		"btc_usd":{
			"decimal_places":3,
			"min_price":0.1,
			"max_price":400,
			"min_amount":0.01,
			"hidden":0,
			"fee":0.2
		}
		...
	}
}
```

**decimal_places**: количество знаков после запятой разрешенные при торгах.
**min_price**: минимальная цена разрешенная при торгах.
**max_price**: максимальная цена разрешенная при торгах.
**min_amount**: минимальное количество разрешенное для покупки/продажи.
**hidden**: скрыта ли пара, значение 0 или 1.
**fee**: комиссия пары.

Скрытая пара (*hidden=1*) продолжает работать, но не отображается в списке пар на главной странице.
Комиссия отображается для всех пользователей, она не изменится если на вашем аккаунте она изменена (например по акции).
При отключении нами какой либо пары, она просто пропадет из списка.

# Метод ticker

Данный метод предоставляет всю информацию о торгах по паре, такую как: максимальная цена, минимальная цена, средняя цена, объем торгов, объем торгов в валюте, последняя сделка, цена покупки и продажи.
Вся информация предоставлена за последние 24 часа.

**Пример запроса**:
https://wex.nz/api/3/ticker/btc_usd

**Пример ответа**:
```json
{
	"btc_usd":{
		"high":109.88,
		"low":91.14,
		"avg":100.51,
		"vol":1632898.2249,
		"vol_cur":16541.51969,
		"last":101.773,
		"buy":101.9,
		"sell":101.773,
		"updated":1370816308
	}
	...
}
```

**high**: макcимальная цена.
**low**: минимальная цена.
**avg**: средняя цена.
**vol**: объем торгов.
**vol_cur**: объем торгов в валюте.
**last**: цена последней сделки.
**buy**: цена покупки.
**sell**: цена продажи.
**updated**: последнее обновление кэша.

# Метод trades

Данный метод предоставляет информацию о последних сделках.

Дополнительно принимает необязательный GET-параметр limit, который указывает, сколько сделок нужно вывести (по умолчанию 150).
Принимает значение не более 5000.

**Пример запроса**:
https://wex.nz/api/3/trades/btc_usd

**Пример ответа**:
```json
{
	"btc_usd":[
		{
			"type":"ask",
			"price":103.6,
			"amount":0.101,
			"tid":4861261,
			"timestamp":1370818007
		},
		{
			"type":"bid",
			"price":103.989,
			"amount":1.51414,
			"tid":4861254,
			"timestamp":1370817960
		},
		...
	]
	...
}
```

**type**: ask - продажа, bid - покупка.
**price**: цена покупки/продажи.
**amount**: количество купленного/проданного.
**tid**: идентификатор сделки.
**timestamp**: UNIX time сделки.




